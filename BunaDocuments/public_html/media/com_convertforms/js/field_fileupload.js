ConvertForms.Helper.onReady(function(e){var d,p;"undefined"!=typeof Dropzone&&(d=ConvertForms.Helper.getBaseURL("task=field.ajax&field_type=fileupload"),p=ConvertForms.Helper.getCSRFToken(),Dropzone.autoDiscover=!1,e.forEach(function(s){var e=s.querySelectorAll(".cfupload"),c=[];e.forEach(function(a){var e,t=a.closest(".cf-control-input").querySelector(".cfup-tmpl"),r=t.innerHTML;t.closest(".cf-control-input").removeChild(t);var o=(o=parseFloat(a.getAttribute("data-maxfilesize")))||null,n=(n=parseInt(a.getAttribute("data-maxfiles")))||null,l=s.querySelector("button.cf-btn"),i=new Dropzone(a,((e={url:d,previewTemplate:r,maxFilesize:o,uploadMultiple:1!=n,maxFiles:n,acceptedFiles:a.getAttribute("data-acceptedfiles"),autoProcessQueue:!0,parallelUploads:1,filesizeBase:1e3,createImageThumbnails:!1,timeout:0,dictFallbackMessage:ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_FALLBACK_MESSAGE"),dictInvalidFileType:ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_INVALID_FILE")}).dictFallbackMessage=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_FALLBACK_MESSAGE"),e.dictFileTooBig=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_FILETOOBIG"),e.dictResponseError=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_RESPONSE_ERROR"),e.dictCancelUpload=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_CANCEL_UPLOAD"),e.dictCancelUploadConfirmation=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_CANCEL_UPLOAD_CONFIRMATION"),e.dictRemoveFile=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_REMOVE_FILE"),e.dictMaxFilesExceeded=ConvertForms.Helper.text("COM_CONVERTFORMS_UPLOAD_MAX_FILES_EXCEEDED"),e));l&&(i.on("queuecomplete",function(){l.classList.remove("cf-disabled")}),i.on("processing",function(){l.classList.add("cf-disabled")})),i.on("sending",function(e,t,r){r.append("form_id",a.closest("form").querySelector("input[name='cf[form_id]']").value),r.append("field_key",a.getAttribute("data-key")),t.setRequestHeader("X-CSRF-Token",p),r.append(p,1)}),i.on("success",function(e){var t=e.xhr.response;try{t=JSON.parse(t)}catch(e){var r=t.match(/{([^}]*)}/i);null!==r?t=JSON.parse(r[0]):alert("Error! "+e+"<br>"+t)}var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",a.dataset.name),o.setAttribute("value",t.file),e.previewTemplate.appendChild(o)}),c.push(i)}),s.addEventListener("beforeSubmit",function(e){var o;e.defaultPrevented||(o=0,c.forEach(function(e){var t=e.getQueuedFiles().length,r=e.getUploadingFiles().length;o=o+t+r}),0<o&&(e.preventDefault(),e.detail.error=e.detail.instance.text("ERROR_WAIT_FILE_UPLOADS")))}),s.addEventListener("success",function(){c.forEach(function(e){e.removeAllFiles()})})}))});

